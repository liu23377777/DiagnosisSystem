<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŒ»ç”Ÿå·¥ä½œå° - ä¸­åŒ»æ™ºèƒ½è¯Šæ–­ç³»ç»Ÿ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .header {
      background: white;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      color: #667eea;
      font-size: 24px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-info span {
      color: #666;
    }

    .btn {
      padding: 8px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
    }

    .container {
      max-width: 1400px;
      margin: 30px auto;
      padding: 0 20px;
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.3s;
      cursor: pointer;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card-icon {
      font-size: 40px;
      margin-bottom: 15px;
    }

    .card-title {
      font-size: 18px;
      color: #333;
      margin-bottom: 10px;
    }

    .card-desc {
      color: #666;
      font-size: 14px;
      line-height: 1.6;
    }

    .recent-section {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .recent-section h2 {
      margin-bottom: 20px;
      color: #333;
    }

    .recent-list {
      list-style: none;
    }

    .recent-item {
      padding: 15px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .recent-item:last-child {
      border-bottom: none;
    }

    .recent-item:hover {
      background: #f8f9fa;
    }

    .patient-name {
      font-weight: bold;
      color: #333;
    }

    .prescription-no {
      color: #667eea;
      font-size: 14px;
    }

    .status {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-paid {
      background: #d4edda;
      color: #155724;
    }
  </style>
</head>
<body>
<div class="header">
  <h1>ğŸ¥ åŒ»ç”Ÿå·¥ä½œå°</h1>
  <div class="user-info">
    <span>ğŸ‘¨â€âš•ï¸ <span id="doctorName">ç‹åŒ»ç”Ÿ</span></span>
    <button class="btn btn-primary" onclick="logout()">é€€å‡ºç™»å½•</button>
  </div>
</div>

<div class="container">
  <!-- åŠŸèƒ½å¡ç‰‡ -->
  <div class="dashboard">
    <div class="card" onclick="location.href='/doctor/tongue-review'">
      <div class="card-icon">ğŸ‘…</div>
      <div class="card-title">èˆŒè¯Šå®¡æ ¸</div>
      <div class="card-desc">å®¡æ ¸æ‚£è€…æäº¤çš„èˆŒè¯Šè®°å½•ï¼Œæä¾›ä¸“ä¸šè¯Šæ–­å»ºè®®</div>
    </div>

    <div class="card" onclick="location.href='/doctor/create-prescription'">
      <div class="card-icon">ğŸ“</div>
      <div class="card-title">å¼€å…·å¤„æ–¹</div>
      <div class="card-desc">ä¸ºæ‚£è€…å¼€å…·è¥¿è¯ã€ä¸­è¯æˆ–æ£€æŸ¥å¤„æ–¹</div>
    </div>

    <div class="card" onclick="location.href='/doctor/patients'">
      <div class="card-icon">ğŸ‘¥</div>
      <div class="card-title">æ‚£è€…ç®¡ç†</div>
      <div class="card-desc">æŸ¥çœ‹æ‚£è€…åˆ—è¡¨å’Œå°±è¯Šå†å²</div>
    </div>

    <div class="card" onclick="location.href='/doctor/prescriptions'">
      <div class="card-icon">ğŸ“‹</div>
      <div class="card-title">å¤„æ–¹è®°å½•</div>
      <div class="card-desc">æŸ¥çœ‹æˆ‘å¼€å…·çš„å¤„æ–¹è®°å½•</div>
    </div>

    <div class="card" onclick="location.href='/doctor/statistics'">
      <div class="card-icon">ğŸ“Š</div>
      <div class="card-title">æ•°æ®ç»Ÿè®¡</div>
      <div class="card-desc">æŸ¥çœ‹å·¥ä½œæ•°æ®å’Œç»Ÿè®¡åˆ†æ</div>
    </div>
  </div>

  <!-- å¾…å®¡æ ¸èˆŒè¯Šè®°å½• -->
  <div class="recent-section">
    <h2>ğŸ‘… å¾…å®¡æ ¸çš„èˆŒè¯Šè®°å½• <span id="pendingCount" style="color: #667eea; font-size: 14px;"></span></h2>
    <ul class="recent-list" id="pendingDiagnosis">
      <li class="recent-item" style="color: #999; text-align: center; padding: 20px;">
        æ­£åœ¨åŠ è½½...
      </li>
    </ul>
  </div>
</div>

<script>
  // åŠ è½½åŒ»ç”Ÿä¿¡æ¯
  window.onload = function() {
    loadDoctorInfo();
    loadPendingDiagnosis();
  };

  function loadDoctorInfo() {
    fetch('/api/doctor/info')
            .then(response => response.json())
            .then(data => {
              if (data.code === 200) {
                document.getElementById('doctorName').textContent = data.data.realName || 'åŒ»ç”Ÿ';
              }
            })
            .catch(err => {
              console.error('åŠ è½½åŒ»ç”Ÿä¿¡æ¯å¤±è´¥:', err);
            });
  }

  function loadPendingDiagnosis() {
    fetch('/api/doctor/pending-diagnosis')
            .then(response => response.json())
            .then(data => {
              if (data.code === 200) {
                displayPendingDiagnosis(data.data);
                document.getElementById('pendingCount').textContent = `(${data.data.length}æ¡)`;
              } else {
                document.getElementById('pendingDiagnosis').innerHTML = 
                  '<li class="recent-item" style="color: #999; text-align: center; padding: 20px;">æš‚æ— å¾…å®¡æ ¸è®°å½•</li>';
              }
            })
            .catch(err => {
              console.error('åŠ è½½å¾…å®¡æ ¸è®°å½•å¤±è´¥:', err);
              document.getElementById('pendingDiagnosis').innerHTML = 
                '<li class="recent-item" style="color: #999; text-align: center; padding: 20px;">åŠ è½½å¤±è´¥</li>';
            });
  }

  function displayPendingDiagnosis(diagnosisList) {
    const listEl = document.getElementById('pendingDiagnosis');
    if (!diagnosisList || diagnosisList.length === 0) {
      listEl.innerHTML = '<li class="recent-item" style="color: #999; text-align: center; padding: 20px;">æš‚æ— å¾…å®¡æ ¸è®°å½•</li>';
      return;
    }
    
    listEl.innerHTML = diagnosisList.slice(0, 5).map(d => {
      const createTime = d.createTime ? new Date(d.createTime).toLocaleString('zh-CN') : 'æœªçŸ¥æ—¶é—´';
      return `
        <li class="recent-item" onclick="viewDiagnosis(${d.id})" style="cursor: pointer;">
          <div>
            <span class="patient-name">è¯Šæ–­è®°å½• #${d.id}</span>
            <span class="prescription-no">(${createTime})</span>
          </div>
          <span class="status status-pending">å¾…å®¡æ ¸</span>
        </li>
      `;
    }).join('');
  }

  function viewDiagnosis(id) {
    location.href = `/doctor/tongue-review?id=${id}`;
  }

  function logout() {
    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—?')) {
      window.location.href = '/logout';
    }
  }
</script>
</body>
</html>
